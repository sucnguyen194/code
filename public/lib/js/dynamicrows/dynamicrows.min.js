!function(e){e.fn.dynamicrows=function(t){function a(t){var a=e(t).closest(c.row);if(e.fn.autocompleteInput&&u.find("input[data-autocomplete-input]").autocompleteInput("destroy"),c.beforeAdd){var n=c.beforeAdd(a);if(n===!1)return!1}if(c.copy_row)var l=e(t).closest(c.rows).children(c.row+":nth-child("+c.copy_row+")").clone(!0);else var l=a.clone(!0);return l.length?(i(l,!0),c.copy_values&&r(a,l),e.fn.datepick&&l.find("input.datepicker").datepick("destroy"),"fade"==c.animation?(l.hide().insertAfter(a),l.fadeIn(c.animation_speed)):l.insertAfter(a),c.prevent_renaming||o(),e.fn.datepick&&l.find("input.datepicker").datepick(),e.fn.autocompleteInput&&u.find("input[data-autocomplete-input]").autocompleteInput(),c.afterAdd&&c.afterAdd(l),void(c.afterAll&&c.afterAll(l))):!1}function n(t){var a=e(t).closest(c.row);if(c.beforeRemove){var n=c.beforeRemove(a);if(n===!1)return!1}var r=u.children(c.row).length;r>c.minrows?("fade"==c.animation?a.fadeOut(c.animation_speed,function(){e(this).remove()}):a.remove(),c.prevent_renaming||o(),a=null):(i(a),e.fn.autocompleteInput&&a.find("input[data-autocomplete-input]").autocompleteInput("deselect")),c.afterRemove&&c.afterRemove(a),c.afterAll&&c.afterAll(a)}function o(){var t=/(.*?)(\[\d+?\])(?!\[\d+?\])(.*)/g,a=c.index_start-1;u.find(c.row).each(function(){var n=e(this);c.beforeFormUpdateNames&&c.beforeFormUpdateNames(n),a++,n.find(":input").each(function(){e(this).attr("name",function(e,n){return"undefined"===n?!0:(c.form_prefix&&(n=n.substr(c.form_prefix.length),n="TMP"+n),n.replace(t,function(e,t,n,o){var r=t+"["+a+"]"+o;return c.form_prefix&&(r=c.form_prefix+r.substr(3)),r}))}).removeAttr("id")}),c.increment&&n.find(c.increment).html(a+1),c.afterFormUpdateNames&&c.afterFormUpdateNames(n)})}function r(t,a){t.find(":text, textarea, select:not(multiple)").each(function(){var t=e(this),n=t.attr("name");a.find('[name="'+n+'"]').val(t.val())}),t.find(":checkbox, :radio").each(function(){var t=e(this),n=t.attr("name");a.find('[name="'+n+'"]').prop("checked",t.prop("checked"))})}function i(t,a){e(".disabled",t).removeClass("disabled");var n=t.find(":input");n.length&&(n.filter('input[type="hidden"]').val(""),a&&c.copy_values!==!1||n.each(function(){var t=e(this),a=t.prop("type");switch(a){case"color":case"date":case"datetime-local":case"email":case"month":case"number":case"password":case"range":case"search":case"tel":case"text":case"time":case"url":case"week":t.val("");break;case"select-one":case"select-multiple":t.find("option").prop("selected",!1);break;case"checkbox":case"radio":t.prop("checked",!1)}}))}function l(e,t){return t="undefined"==typeof t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}var d=e(this),f={copyRow:"copy_row",copyValues:"copy_values"};e.each(f,function(e,a){"object"==typeof t&&"undefined"!=typeof t[e]&&(console.warn("dynamicrows: option "+e+" is deprecated; please use "+a+" instead"),t[a]=t[e],delete t[e])});var c=e.extend({row:"tr",rows:"tbody",minrows:1,handle_add:"[data-add]:not(.disabled)",handle_remove:"[data-remove]:not(.disabled)",handle_move:"[data-move]:not(.disabled)",index_start:0,copy_row:null,copy_values:!1,increment:null,form_prefix:"",prevent_renaming:!1,animation:!1,animation_speed:300,beforeAdd:null,beforeRemove:null,beforeMove:null,beforeFormUpdateNames:null,beforeAll:null,afterAdd:null,afterRemove:null,afterMove:null,afterFormUpdateNames:null,afterAll:null},t),s=d.data();"object"==typeof s&&e.each(s,function(e,t){var a=l(e);"undefined"!=typeof c[a]&&("string"==typeof t&&0==t.length&&(t=!0),c[a]=t)});var u=c.rows?e(c.rows,this):d;if(c.handle_add&&d.on("click",c.handle_add,function(e){e.preventDefault(),a(this)}),c.handle_remove&&d.on("click",c.handle_remove,function(e){e.preventDefault(),n(this)}),c.handle_move&&u.find(c.handle_move).length>0)if("undefined"!=typeof Sortable){var p=u[0];u.find(c.handle_move).each(function(){var t=e(this).closest(c.row);t.addClass("dynamicrows-row"),t.find(c.handle_move).addClass("dynamicrows-move")});var m={handle:".dynamicrows-move",draggable:".dynamicrows-row",onStart:function(e){c.beforeMove&&c.beforeMove(e.item),c.beforeAll&&c.beforeAll(e.item)},onUpdate:function(e){c.prevent_renaming||o(),c.afterMove&&c.afterMove(e.item),c.afterAll&&c.afterAll(e.item)}};"object"==typeof Sortable?Sortable.init(p,m):"function"==typeof Sortable&&new Sortable(p,m)}else if(jQuery.fn.sortable){var v=[];u.find(c.handle_move).each(function(){v.push(e(this).closest(c.row))}),u.sortable({items:v,handle:c.handle_move,start:function(e,t){c.beforeMove&&c.beforeMove(t.item),c.beforeAll&&c.beforeAll(t.item)},update:function(e,t){c.prevent_renaming||o(),c.afterMove&&c.afterMove(t.item),c.afterAll&&c.afterAll(t.item)}})}else alert("No sortable-plugin found! Please load sortablejs or jquery-ui (with sortable widget).")}}(jQuery),window.Dynamicrows={init:function(e,t){if("string"==typeof e)var e=$(el);e.length&&(t||(t={}),e.each(function(){var e=$(this),a=e.data();a||(a={});var n=$.extend({},a,t);e.dynamicrows(n)}))}};